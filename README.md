# Проект: Парсер цен автомобилей с сайтов

## Описание проекта

Этот проект представляет собой бэкэнд-скрипт на Python, который автоматически собирает данные о 
стоимости автомобилей с различных сайтов (avito.ru, auto.ru, drom.ru), 
рассчитывает среднюю стоимость и определяет залоговую стоимость по заданной формуле.

## Цель разработки

Цель проекта — разработать скрипт, который будет:
1. Парсить данные о ценах на автомобили с различных сайтов.
2. Рассчитывать среднюю стоимость автомобиля.
3. Определять залоговую стоимость по формуле: `Залоговая стоимость = (Средняя стоимость заданного лимита (например 20), автомобилей) * 0.8`.

## Формула расчета

Залоговая стоимость автомобиля рассчитывается по формуле:
Залоговая стоимость = (Средняя стоимость заданного лимита автомобилей) * 0.8
Средняя стоимость определяется как:
Средняя стоимость = Сумма цен заданного лимита Х автомобилей / Х заданного лимита (например: сумма цен 30 автомобилей / 20)


## Источники данных

- **avito.ru** (раздел авто)
- **auto.ru**
- **drom.ru**

## Функционал:

### 1. Парсинг данных
- Скрипт подключается к сайтам-источникам.
- Запрашивает данные по заданной марке, модели, год (или диапазон лет от и до), автомобиля.
- Извлекает цену автомобиля.
- Сохраняет полученные данные в JSON файл.

### 2. Расчет залоговой стоимости
- После получения цен заданного лимита автомобилей по каждой модели, выполняется расчет средней цены.
- От средней цены автоматически отнимается 20% — это и есть залоговая стоимость.

### 3. Обработка исключений
- Если не удалось получить данные с какого-либо сайта (сайт недоступен, капча, блокировка IP), это логируется.
- При получении менее заданного лимита автомобилей по одной модели скрипт продолжает работать, но расчет производится на основе имеющихся данных с пометкой об этом.

### 4. Настройка прокси
- Скрипт настроен на работу через прокси-серверы, что позволяет значительно сократить время запроса между страницами. 
Это не гарантирует, но помогает избегать блокировки. Проверено на резидентских и мобильных прокси провайдера "https://rus.proxy.market/" (с VPN), 
остальные типы прокси-серверов не пускает защита сайтов. 
- Формат прокси следующий (обязательно):
- ip:port@login:password 
- Выкладываются списком в файл: proxies.txt 
- Если прокси не работают, закончилась абонплата или они отсутствуют, то после 3х неудачных попыток скрипт переходит к использованию собственного ip. Тогда время запроса между страницами значительно увеличивается для маскировки под пользователя с целью избежать блокировки.

## Технические требования

- **Язык разработки:** Python 3.13
- **Используемые библиотеки:** `requests`, `BeautifulSoup`, `pandas`, `logging`, `json` `Silenium`.
- **Поддержка многопоточности** для ускорения парсинга.
- **Логирование всех операций** (успех, ошибки, предупреждения).
- Возможность запуска через команду в терминале с передачей параметров.

## Установка и запуск

1. Установка зависимостей.
Для установки необходимых зависимостей выполните команду:
    ```bash
    pip install -r requirements.txt

2. Запуск скрипта.
Для запуска скрипта используйте следующие команды:



### С указанием лимита количества цен

* Лимит задаётся от 10 до 100 цен.
* python main.py --make <марка автомобиля> --model <модель автомобиля> --year <2020 2023> --limit <30 количество цен>

* Если --limit указан некорректно (например, 5 или 150), программа выдаст ошибку:
"Ошибка: Количество цен должно быть в диапазоне от 10 до 100."


### Поиск по одному году с лимитом.
* Например, с лимитом 20 цен:
    ```bash
    python main.py --make Toyota --model Camry --year 2020 --limit 20
* Парсинг цен Toyota Camry только 2020 года. (с лимитом 20 цен)


### Поиск с диапазоном годов от и до
* Например, с лимитом 30 цен
    ```bash
  python main.py --make BMW --model X5 --year 2015 2024 --limit 30

* Парсинг всех цен BMW X5 от 2015 до 2024 года. (с лимитом 30 цен)

### Только с годом для поиска (по умолчанию лимит 100 цен):
* python main.py --make <марка автомобиля> --model <модель автомобиля> --year <2020>


* Пример:
    ```bash
    python main.py --make BMW --model X5 --year 2020

* Будет собрано до 100 цен с каждого сайта.


### С диапазоном поиска года от и до (по умолчанию лимит 100 цен):
* python main.py --make <марка автомобиля> --model <модель автомобиля> --year <2020 2023>


* Примечание: если задан большой лимит цен для поиска, а таких автомобилей мало (например, с заданным годом мало на рынке),
то при поиске будет перебираться много страниц, это увеличивает время работы скрипта, необходимо делать паузы,
так как есть возможность блокировки даже при использовании прокси-серверов.



* Пример:
    ```bash
  python main.py --make BMW --model X5 --year 2020 2023

* Будет также собрано до 100 цен с каждого сайта.

3. Логирование.
* Логи работы скрипта сохраняются в папке logs/ в файле с именем parser_log_YYYY-MM-DD.log.

4. Автоматический скриншот.

* Создана функция скриншота при ошибках подключения к сайту, сохраняются в папку error/

5. Результаты работы скрипта сохраняются в папке data/ в формате JSON. Имя файла формируется на основе даты, марки и модели автомобиля.

* Пример вывода.
После успешного выполнения скрипта, вы получите JSON-файл с результатами:
    ```json
  {
  "make": "BMW",
  "model": "X5",
  "average_price": 3250000,
  "collateral_value": 2600000,
  "cars_parsed": 100
  }

Лицензия.
Этот проект распространяется под лицензией MIT.

Автор 
[DenGrif](https://github.com/DenGrif)

Контакты:
Если у вас есть вопросы или предложения, 
свяжитесь со мной по адресу: [grifon991@gmail.com](mailto:grifon991@gmail.com).

[Мой Telegram](https://t.me/DenGrifon)


